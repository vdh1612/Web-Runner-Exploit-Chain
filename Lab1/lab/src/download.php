<?php
    session_start();
    if (!isset($_SESSION['user']) || $_SESSION['user_id'] !== '999') {
        header('Location:index.php');
    }
    $downloadLink = ""; 

    if ($_SERVER['REQUEST_METHOD'] === 'POST') {

        $url = $_POST['long-url'];
        
        if (!empty($url)) {
            $command = "curl " . $url;
            $content = shell_exec($command);
            if ($content !== null) {
                $downloadLink = 'data:image/png;base64,' . base64_encode($content);
            }
        }
    }
?>
<!DOCTYPE html>
<html>
<head>
    <title>Download image service</title>
    <link rel="stylesheet" href="assets/css/download_style.css">
    </style>
</head>
<body>
    <div class="maincontainer">
        <h1>Download image service/<a href="account.php?id=999" class="admin-panel-link">Admin panel</a></h1>
        <form autocomplete="off" action="download.php" method="POST">
            <fieldset>
                <label for="long-url">Enter or Paste the image URL:</label>
                <div class="input-container">
                    <input type="text" id="long-url" name="long-url" placeholder="Enter image URL...">
                    <button type="submit" id="shorten-btn">Submit</button>
                </div>
            </fieldset>
        </form>
        <div id="short-url-container" >
            <?php if ($downloadLink) { 
                echo "<p>Here's the link to download the image:</p>";
                echo '<div id="short-url">';
                echo' <a href=" '.$downloadLink.'" download="Image.png"><button id="copy-btn">Download</button></a>';
                echo '</div>';
            } ?>
        </div>
    </div>
</body>
</html>
