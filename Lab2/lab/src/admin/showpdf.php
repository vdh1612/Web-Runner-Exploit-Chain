<?php
session_start();
include('../database.php');

if (!isset($_SESSION['user']) || $_SESSION['user'] !== 'admin') {
    header('Location:../login.php');
}

if (isset($_GET['file_name'])) {
    $file_name = $_GET['file_name'];
    $sql = "SELECT * FROM pdf_files WHERE file_name = '$file_name'";
    $result = $conn->query($sql);
    if ($result->num_rows > 0) {
        while ($row = $result->fetch_assoc()) {
            $file_path = $row["file_path"];
            $path = '../'.$file_path . '/' . $file_name;
            
            // Check if the file exists
            if (file_exists($path)) {
                header('Content-Type: application/pdf');
                header('Content-Disposition: inline; filename="' . $file_name . '"');
                
                // Output the file content
                readfile($path);
            } else {
                echo "File not found.";
            }
        }
    } else {
        echo "No file found with the specified name.";
    }
} else {
    echo "File name not specified.";
}


$conn->close();
?>