FROM php:8.0-apache

RUN apt-get update 

# Installs and enables the necessary PHP extensions for MySQL.
RUN docker-php-ext-install mysqli  && docker-php-ext-enable mysqli 

WORKDIR /var/www/html/

COPY ./src .

# Changes ownership of the files to root and the group to www-data.
RUN chown -R root:www-data /var/www/html

# set appopriate permissions for the application files and directories
RUN chmod 750 /var/www/html
RUN find . -type f -exec chmod 640 {} \;
RUN find . -type d -exec chmod 750 {} \;

# Adds write permissions for the group to the upload
RUN chmod g+w /var/www/html/upload/

# Adds the sticky bit to ensure only the file owner can delete or rename the files.
RUN chmod +t -R /var/www/html/

# Append a flag to the passwd file for demonstration purposes
RUN echo "Bounty_boys{2nd_flag}" >> /etc/passwd
