<?php
session_start();
// $user_ip = $_SERVER['REMOTE_ADDR'];


// if ($user_ip !== '127.0.0.1') {
//     header("HTTP/1.0 404 Not Found");
//     echo "<h1>404 Not Found</h1>";
//     echo "The page that you have requested could not be found.";
//     exit();
// }
// payload: O:12:"DetailedNote":1:{s:7:"details";s:35:"echo shell_exec('cat /etc/passwd');";}

include("detail.php");

class Note {
    public $title;
    public $content;

    public function __construct($title, $content) {
        $this->title = $title;
        $this->content = $content;
    }

    public function getTitle() {
        return $this->title;
    }

    public function getContent() {
        return $this->content;
    }
}

if ($_SERVER['REQUEST_METHOD'] == 'GET' && isset($_GET['title']) && isset($_GET['content'])) {
    $title = $_GET['title'];
    $content = $_GET['content'];

    if (!empty($title) && !empty($content)) {
        $note = new Note($title, $content);
        $filename = 'note/' . session_id() . '.txt';
        $serializedNote = serialize($note);
        file_put_contents($filename, $serializedNote . "||", FILE_APPEND);
        echo "Note has been saved.";
    } else {
        echo "Please enter both title and content.";
    }
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Notes</title>
</head>
<body>
    <h2>Admin Notes</h2>
    <form method="GET" action="">
        <input type="text" name="title" placeholder="Title" required>
        <br>
        <textarea name="content" rows="10" cols="50" placeholder="Content" required></textarea>
        <br>
        <button type="submit">Save Note</button>
    </form>

    <h3>Existing Notes</h3>
    <ul>
        <?php 
            $notesDir = 'note/';
            if (is_dir($notesDir)) {
                $noteFiles = glob($notesDir . '*.txt');
                foreach ($noteFiles as $noteFile) {
                    $serializedNotes = file_get_contents($noteFile);
                    $serializedNotesArray = explode("||", $serializedNotes);
                    foreach ($serializedNotesArray as $serializedNote) { 
                        if (!empty($serializedNote)) {
                            $note = @unserialize($serializedNote);
                            if ($note !== false && is_object($note)) {
                                echo "<li>";
                                if (method_exists($note, 'getTitle')) {
                                    echo "<h5>Title: " . htmlspecialchars($note->getTitle()) . "</h5>";
                                }
                                if (method_exists($note, 'getContent')) {
                                    echo "<h5>Content: " . htmlspecialchars($note->getContent()) . "</h5>";
                                }
                                echo "</li>";
                            }
                        }
                    }
                }
            }
        ?>
    </ul>
</body>
</html>
