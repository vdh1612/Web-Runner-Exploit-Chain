$(document).ready(function(){
    $('#blogForm').on('submit', function(event){
        event.preventDefault();

        var title = $('#title').val();
        var content = $('#content').val();
        var image = $('#image')[0].files[0];

        // use DOMParser và XMLSerializer để tạo XML
        var parser = new DOMParser();
        var xmlDoc = parser.parseFromString('<blog></blog>', 'application/xml');

        var titleElement = xmlDoc.createElement('title');
        titleElement.textContent = title;
        xmlDoc.documentElement.appendChild(titleElement);

        var contentElement = xmlDoc.createElement('content');
        contentElement.textContent = content;
        xmlDoc.documentElement.appendChild(contentElement);

        var serializer = new XMLSerializer();
        var xmlString = serializer.serializeToString(xmlDoc);

        var formData = new FormData();
        formData.append('xml', new Blob([xmlString], { type: 'application/xml' }));
        formData.append('image', image);

        $.ajax({
            url: 'add_blog.php',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function(response, textStatus, xhr) {
                if ($(response).find('.alert-danger').length > 0) {
                    // Error messages found in response
                    alert('Error: ' + $(response).find('.alert-danger').text().trim());
                }else {
                    window.location.href = '../blog.php';
                }
            },
            error: function(jqXHR, textStatus, errorThrown) {
                alert('Error: ' + errorThrown);
            }
        });
    });
});